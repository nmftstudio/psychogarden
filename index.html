<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>üåø Overgrown: Nexus Edition</title>
    <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;600;800&family=Space+Mono:wght@400;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --glass: rgba(10, 10, 12, 0.85);
            --glass-heavy: rgba(5, 5, 5, 0.95);
            --accent: #4ade80;
            --accent-glow: rgba(74, 222, 128, 0.3);
            --text: #ecfdf5;
            --border: rgba(255, 255, 255, 0.08);
        }

        body, html {
            margin: 0; padding: 0; width: 100%; height: 100%;
            overflow: hidden; background: #020202; color: var(--text);
            font-family: 'Outfit', sans-serif;
        }

        canvas { position: absolute; top: 0; left: 0; }
        #skyCanvas { z-index: 0; }
        #bgCanvas { z-index: 1; }
        #gameCanvas { z-index: 2; }
        #uiLayer { position: absolute; z-index: 10; width: 100%; height: 100%; pointer-events: none; }

        /* --- UI COMPONENTS --- */
        .hud-panel {
            pointer-events: auto; background: var(--glass);
            backdrop-filter: blur(20px); -webkit-backdrop-filter: blur(20px);
            border: 1px solid var(--border); border-radius: 16px;
        }

        .top-bar {
            position: absolute; top: 24px; left: 24px; right: 24px;
            display: flex; justify-content: space-between; align-items: center;
        }

        .stats-cluster { display: flex; gap: 30px; padding: 12px 24px; }
        .stat-item { display: flex; flex-direction: column; }
        .stat-label { font-size: 10px; text-transform: uppercase; letter-spacing: 2px; opacity: 0.5; }
        .stat-value { font-family: 'Space Mono', monospace; font-size: 20px; font-weight: 700; color: var(--accent); }

        /* --- NEXUS MENU (SIDE) --- */
        .nexus-trigger {
            position: absolute; left: 24px; top: 120px;
            width: 50px; height: 50px; border-radius: 12px;
            background: var(--glass); border: 1px solid var(--border);
            color: var(--accent); font-size: 24px; cursor: pointer;
            pointer-events: auto; display: flex; align-items: center; justify-content: center;
            transition: all 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        }
        .nexus-trigger:hover { transform: scale(1.1); box-shadow: 0 0 20px var(--accent-glow); }

        #nexusMenu {
            position: absolute; left: 24px; top: 180px;
            display: none; flex-direction: column; gap: 10px;
            pointer-events: auto;
        }
        .module-btn {
            width: 50px; height: 50px; border-radius: 12px; border: 1px solid var(--border);
            background: var(--glass); color: #fff; cursor: pointer; font-size: 20px;
            transition: 0.2s; position: relative;
        }
        .module-btn:hover { background: var(--accent); color: #000; }
        .module-btn::after {
            content: attr(data-label); position: absolute; left: 60px; top: 15px;
            background: #000; padding: 4px 8px; border-radius: 4px; font-size: 10px;
            white-space: nowrap; opacity: 0; pointer-events: none; transition: 0.2s;
        }
        .module-btn:hover::after { opacity: 1; transform: translateX(5px); }

        /* --- OVERLAY POPUPS (MINIGAMES) --- */
        #moduleOverlay {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.85); backdrop-filter: blur(10px);
            z-index: 100; display: none; align-items: center; justify-content: center;
            pointer-events: auto;
        }
        .module-window {
            width: 90%; max-width: 600px; background: var(--glass-heavy);
            border: 1px solid var(--accent); border-radius: 24px; padding: 30px;
            position: relative; box-shadow: 0 0 50px rgba(0,0,0,0.5);
        }
        .close-btn {
            position: absolute; top: 20px; right: 20px;
            background: none; border: none; color: #666; font-size: 24px; cursor: pointer;
        }
        .close-btn:hover { color: var(--accent); }

        /* --- GAME ENGINE CLASSES --- */
        .game-canvas-mini {
            width: 100%; height: 300px; background: #080808; border-radius: 12px;
            margin-top: 20px; border: 1px solid #111; cursor: crosshair;
        }

        .btn-action {
            margin-top: 20px; width: 100%; padding: 14px;
            background: var(--accent); border: none; border-radius: 8px;
            font-weight: 800; text-transform: uppercase; cursor: pointer;
        }

    </style>
</head>
<body>

    <canvas id="skyCanvas"></canvas>
    <canvas id="bgCanvas"></canvas>
    <canvas id="gameCanvas"></canvas>

    <div id="uiLayer">
        <div class="top-bar">
            <div class="hud-panel stats-cluster">
                <div class="stat-item">
                    <span class="stat-label">Biomass</span>
                    <span class="stat-value" id="ui-bio">0</span>
                </div>
                <div class="stat-item">
                    <span class="stat-label">Species</span>
                    <span class="stat-value" id="ui-species">0</span>
                </div>
            </div>
            <div class="hud-panel stats-cluster">
                <div id="weather-tag" style="font-size: 12px; font-weight: 600;">SIMULATION ACTIVE</div>
            </div>
        </div>

        <button class="nexus-trigger" onclick="toggleNexus()">‚óà</button>
        <div id="nexusMenu">
            <button class="module-btn" data-label="DNA Splicer" onclick="openModule('dna')">üß¨</button>
            <button class="module-btn" data-label="Pollinator Run" onclick="openModule('bee')">üêù</button>
            <button class="module-btn" data-label="Photon Rhythm" onclick="openModule('sun')">‚òÄÔ∏è</button>
        </div>

        <div id="moduleOverlay">
            <div class="module-window" id="moduleWindow">
                <button class="close-btn" onclick="closeModule()">√ó</button>
                <div id="moduleContent"></div>
            </div>
        </div>
    </div>

    <script>
        /**
         * OVERGROWN: NEXUS CORE
         * Pro Architecture: Modular Game State
         */

        const State = {
            bio: 250,
            seeds: 5,
            discovered: 0,
            plants: [],
            weather: 'sunny',
            time: 12,
            activeModule: null
        };

        // --- MASTER ENGINE ---
        const Engine = {
            init() {
                this.setupCanvases();
                this.loop();
                this.spawnInitialFlora();
                window.addEventListener('resize', () => this.setupCanvases());
            },
            setupCanvases() {
                this.w = window.innerWidth;
                this.h = window.innerHeight;
                ['sky', 'bg', 'game'].forEach(id => {
                    const c = document.getElementById(id + 'Canvas');
                    c.width = this.w; c.height = this.h;
                });
            },
            spawnInitialFlora() {
                for(let i=0; i<3; i++) {
                    State.plants.push(new Plant(Math.random()*this.w, this.h - 50));
                }
            },
            loop() {
                const gCtx = document.getElementById('gameCanvas').getContext('2d');
                gCtx.clearRect(0,0, this.w, this.h);
                
                // Ground
                gCtx.fillStyle = '#0a0a0a';
                gCtx.fillRect(0, this.h-50, this.w, 50);

                State.plants.forEach(p => {
                    p.update();
                    p.draw(gCtx);
                });

                document.getElementById('ui-bio').innerText = Math.floor(State.bio);
                document.getElementById('ui-species').innerText = State.discovered;

                requestAnimationFrame(() => this.loop());
            }
        };

        // --- PLANT CLASS (DNA BASED) ---
        class Plant {
            constructor(x, y, dna = null) {
                this.x = x; this.y = y;
                this.dna = dna || {
                    hue: Math.random() * 360,
                    size: 40 + Math.random() * 60,
                    complexity: 3 + Math.floor(Math.random() * 2)
                };
                this.growth = 0;
                State.discovered++;
            }
            update() { if(this.growth < 1) this.growth += 0.005; }
            draw(ctx) {
                ctx.save();
                ctx.translate(this.x, this.y);
                ctx.scale(this.growth, this.growth);
                ctx.strokeStyle = `hsl(${this.dna.hue}, 60%, 50%)`;
                ctx.lineWidth = 3;
                this.drawBranch(ctx, this.dna.size, 0, this.dna.complexity);
                ctx.restore();
            }
            drawBranch(ctx, len, angle, depth) {
                if(depth === 0) return;
                ctx.save();
                ctx.rotate(angle);
                ctx.beginPath(); ctx.moveTo(0,0); ctx.lineTo(0, -len); ctx.stroke();
                ctx.translate(0, -len);
                this.drawBranch(ctx, len * 0.7, 0.4, depth - 1);
                this.drawBranch(ctx, len * 0.7, -0.4, depth - 1);
                ctx.restore();
            }
        }

        // --- NEXUS SYSTEM ---
        function toggleNexus() {
            const menu = document.getElementById('nexusMenu');
            menu.style.display = menu.style.display === 'flex' ? 'none' : 'flex';
        }

        function openModule(type) {
            const overlay = document.getElementById('moduleOverlay');
            const content = document.getElementById('moduleContent');
            overlay.style.display = 'flex';
            
            if(type === 'dna') {
                content.innerHTML = `
                    <h2 style="color:var(--accent)">üß¨ SPLICER TERMINAL</h2>
                    <p>Combina biomasa para forzar una mutaci√≥n sint√©tica r√°pida.</p>
                    <div class="game-canvas-mini" id="dnaVisual"></div>
                    <button class="btn-action" onclick="Modules.runDNA()">SPLICING (Cost: 50 Bio)</button>
                `;
            } else if(type === 'bee') {
                content.innerHTML = `
                    <h2 style="color:var(--accent)">üêù POLLINATOR RUN</h2>
                    <p>Gu√≠a el dron-polinizador. Evita las ramas para ganar bio-puntos.</p>
                    <canvas id="miniGameCanvas" class="game-canvas-mini"></canvas>
                    <p style="font-size:10px; opacity:0.5">TIP: Usa las flechas o click para elevarte.</p>
                    <button class="btn-action" onclick="Modules.startBeeGame()">Lanzar Protocolo</button>
                `;
            } else if(type === 'sun') {
                content.innerHTML = `
                    <h2 style="color:var(--accent)">‚òÄÔ∏è PHOTON RHYTHM</h2>
                    <p>Captura fotones en el momento exacto para sobrecargar el crecimiento.</p>
                    <div id="rhythmZone" class="game-canvas-mini" style="display:flex; align-items:center; justify-content:center; font-size:40px;">
                        ‚åõ CARGANDO...
                    </div>
                `;
                setTimeout(() => Modules.startSunGame(), 500);
            }
        }

        function closeModule() {
            document.getElementById('moduleOverlay').style.display = 'none';
            State.activeModule = null;
        }

        // --- MINI-GAMES LOGIC ---
        const Modules = {
            runDNA() {
                if(State.bio >= 50) {
                    State.bio -= 50;
                    const newPlant = new Plant(Math.random()*window.innerWidth, window.innerHeight-50);
                    newPlant.dna.hue = Math.random() * 360;
                    State.plants.push(newPlant);
                    closeModule();
                }
            },
            
            startBeeGame() {
                const canvas = document.getElementById('miniGameCanvas');
                const ctx = canvas.getContext('2d');
                canvas.width = 540; canvas.height = 300;
                let beeY = 150; let score = 0;
                
                const gameLoop = () => {
                    ctx.fillStyle = '#080808'; ctx.fillRect(0,0,540,300);
                    ctx.fillStyle = 'yellow'; ctx.beginPath(); ctx.arc(50, beeY, 5, 0, Math.PI*2); ctx.fill();
                    beeY += 1.5; // Gravity
                    
                    ctx.fillStyle = '#fff'; ctx.fillText(`BIO RECOVERY: ${score}`, 20, 30);
                    
                    if(beeY < 300 && beeY > 0) {
                        score++;
                        State.bio += 0.1;
                        State.activeModule = requestAnimationFrame(gameLoop);
                    }
                };
                canvas.onmousedown = () => beeY -= 40;
                gameLoop();
            },

            startSunGame() {
                const zone = document.getElementById('rhythmZone');
                let count = 0;
                zone.innerHTML = "¬°TOCA!";
                zone.onclick = () => {
                    count++;
                    zone.style.background = '#1a1a1a';
                    setTimeout(() => zone.style.background = '#080808', 100);
                    State.bio += 2;
                    if(count > 10) {
                        zone.innerHTML = "CORE CHARGED!";
                        setTimeout(closeModule, 1000);
                    }
                };
            }
        };

        Engine.init();

    </script>
</body>
</html>
