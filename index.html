<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>AETERNA | Bio-Digital Ecosystem</title>
    <link href="https://fonts.googleapis.com/css2?family=Libre+Baskerville:ital,wght@0,400;0,700;1,400&family=Space+Mono&display=swap" rel="stylesheet">
    <style>
        :root {
            --gold: #d4af37;
            --emerald: #2d5a27;
            --void: #050705;
            --glass: rgba(10, 15, 10, 0.9);
            --border: rgba(212, 175, 55, 0.3);
        }

        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { 
            background: var(--void); 
            color: #e0eadd; 
            font-family: 'Libre Baskerville', serif; 
            overflow: hidden;
        }

        canvas { position: absolute; top: 0; left: 0; display: block; }
        #fxCanvas { pointer-events: none; z-index: 5; }

        #interface {
            position: absolute; z-index: 100; width: 100%; height: 100%;
            pointer-events: none; display: flex; flex-direction: column;
            justify-content: space-between; padding: 30px;
        }

        .hud-top { display: flex; justify-content: space-between; pointer-events: auto; }
        .data-box { 
            background: var(--glass); border: 1px solid var(--border);
            padding: 12px 20px; border-radius: 4px; backdrop-filter: blur(10px);
        }
        .data-box label { font-family: 'Space Mono', monospace; font-size: 10px; text-transform: uppercase; color: var(--gold); display: block; }
        .data-box span { font-size: 20px; font-weight: 700; }

        .nexus-nav { 
            position: absolute; left: 30px; top: 50%; transform: translateY(-50%);
            display: flex; flex-direction: column; gap: 15px; pointer-events: auto;
        }
        .nexus-btn {
            width: 45px; height: 45px; border: 1px solid var(--border);
            background: var(--glass); color: var(--gold); border-radius: 50%;
            cursor: pointer; transition: 0.3s; font-size: 18px;
        }
        .nexus-btn:hover { background: var(--gold); color: var(--void); transform: scale(1.1); }

        .toolbar { 
            display: flex; justify-content: center; gap: 10px; pointer-events: auto;
            margin-bottom: 10px;
        }
        .tool {
            padding: 10px 20px; background: var(--glass); border: 1px solid var(--border);
            color: #fff; cursor: pointer; font-family: 'Space Mono', monospace;
            text-transform: uppercase; font-size: 11px; transition: 0.2s;
        }
        .tool.active { border-color: var(--gold); background: rgba(212, 175, 55, 0.1); color: var(--gold); }

        .modal {
            position: fixed; inset: 0; background: rgba(0,0,0,0.9);
            display: none; align-items: center; justify-content: center; z-index: 1000;
            pointer-events: auto;
        }
        .modal-content {
            width: 90%; max-width: 500px; padding: 40px; border: 1px solid var(--gold);
            background: var(--void); text-align: center;
        }
        .market-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-top: 20px; }
        .market-item { border: 1px solid var(--border); padding: 15px; cursor: pointer; }
        .market-item:hover { border-color: var(--gold); }
    </style>
</head>
<body>

    <canvas id="skyCanvas"></canvas>
    <canvas id="mainCanvas"></canvas>
    <canvas id="fxCanvas"></canvas>

    <div id="interface">
        <div class="hud-top">
            <div class="data-box">
                <label>Energy</label>
                <span id="stat-bio">1000</span>
            </div>
            <div class="data-box" style="text-align: right;">
                <label>Flux</label>
                <span id="stat-weather">Stable</span>
            </div>
        </div>

        <div class="nexus-nav">
            <button class="nexus-btn" onclick="openModule('market')">üõí</button>
            <button class="nexus-btn" onclick="openModule('dna')">üß¨</button>
            <button class="nexus-btn" onclick="openModule('swarm')">üêù</button>
        </div>

        <div class="toolbar">
            <button class="tool active" id="tool-plant" onclick="setTool('plant')">Plant</button>
            <button class="tool" id="tool-extract" onclick="setTool('extract')">Extract</button>
        </div>
    </div>

    <div id="modal" class="modal">
        <div class="modal-content">
            <div id="modal-inner"></div>
            <button class="tool" style="margin-top:20px" onclick="closeModal()">Return</button>
        </div>
    </div>

    <script>
        const STATE = {
            bio: 1000, plants: [], entities: [],
            tool: 'plant', horizon: 0,
            colors: { gold: '#d4af37', emerald: '#2d5a27', void: '#050705' }
        };

        const canvasM = document.getElementById('mainCanvas');
        const canvasS = document.getElementById('skyCanvas');
        const ctxM = canvasM.getContext('2d');
        const ctxS = canvasS.getContext('2d');

        class Plant {
            constructor(x, y) {
                this.x = x; this.y = y;
                this.growth = 0;
                this.age = 0;
                this.hue = 100 + Math.random() * 40;
                this.split = 0.4 + Math.random() * 0.3;
            }
            update() {
                if(this.growth < 1) this.growth += 0.005;
                this.age += 0.02;
            }
            draw(ctx) {
                ctx.save();
                ctx.translate(this.x, this.y);
                this.renderBranch(ctx, 60 * this.growth, 0, 5);
                ctx.restore();
            }
            renderBranch(ctx, len, angle, depth) {
                if(depth <= 0) return;
                ctx.save();
                ctx.rotate(angle + Math.sin(this.age + len) * 0.02);
                ctx.strokeStyle = `hsl(${this.hue}, 30%, ${10 + (6-depth)*8}%)`;
                ctx.lineWidth = depth * 1.2;
                ctx.beginPath(); ctx.moveTo(0,0); ctx.lineTo(0, -len); ctx.stroke();
                ctx.translate(0, -len);
                this.renderBranch(ctx, len * 0.75, this.split, depth - 1);
                this.renderBranch(ctx, len * 0.75, -this.split, depth - 1);
                ctx.restore();
            }
        }

        class Observer {
            constructor() {
                this.x = -50; this.y = STATE.horizon;
                this.targetX = Math.random() * window.innerWidth;
                this.speed = 0.7;
            }
            update() {
                this.x += this.speed;
                if(Math.abs(this.x - this.targetX) < 5 && Math.random() < 0.01) {
                    STATE.plants.push(new Plant(this.x, STATE.horizon));
                    this.targetX = this.x + 200 + Math.random()*300;
                }
                return this.x < window.innerWidth + 100;
            }
            draw(ctx) {
                ctx.fillStyle = "white";
                ctx.fillRect(this.x - 2, this.y - 30, 4, 20);
                ctx.beginPath(); ctx.arc(this.x, this.y - 35, 4, 0, Math.PI*2); ctx.fill();
            }
        }

        function init() {
            resize();
            window.addEventListener('resize', resize);
            canvasM.addEventListener('mousedown', handleInput);
            requestAnimationFrame(loop);
            
            // Spawn inicial
            for(let i=0; i<3; i++) STATE.plants.push(new Plant(Math.random()*window.innerWidth, STATE.horizon));
            setInterval(() => { if(STATE.entities.length < 1) STATE.entities.push(new Observer()); }, 15000);
        }

        function resize() {
            STATE.horizon = window.innerHeight * 0.6;
            [canvasM, canvasS].forEach(c => {
                c.width = window.innerWidth;
                c.height = window.innerHeight;
            });
        }

        function loop() {
            // Fondo
            ctxS.fillStyle = STATE.colors.void;
            ctxS.fillRect(0,0, canvasS.width, canvasS.height);
            
            ctxM.clearRect(0,0, canvasM.width, canvasM.height);
            
            // Suelo
            ctxM.fillStyle = '#080a08';
            ctxM.fillRect(0, STATE.horizon, canvasM.width, canvasM.height);
            
            // Plantas
            STATE.plants.forEach(p => { p.update(); p.draw(ctxM); });
            
            // Entidades
            STATE.entities = STATE.entities.filter(e => {
                const active = e.update();
                e.draw(ctxM);
                return active;
            });

            document.getElementById('stat-bio').innerText = Math.floor(STATE.bio);
            requestAnimationFrame(loop);
        }

        function handleInput(e) {
            const x = e.clientX;
            const y = e.clientY;
            if(STATE.tool === 'plant' && y > STATE.horizon - 100) {
                if(STATE.bio >= 50) {
                    STATE.bio -= 50;
                    STATE.plants.push(new Plant(x, STATE.horizon));
                }
            } else if(STATE.tool === 'extract') {
                STATE.plants = STATE.plants.filter(p => {
                    if(Math.hypot(p.x - x, p.y - y) < 40) {
                        STATE.bio += 120;
                        return false;
                    }
                    return true;
                });
            }
        }

        function setTool(t) {
            STATE.tool = t;
            document.querySelectorAll('.tool').forEach(b => b.classList.remove('active'));
            document.getElementById(`tool-${t}`).classList.add('active');
        }

        function openModule(type) {
            document.getElementById('modal').style.display = 'flex';
            const inner = document.getElementById('modal-inner');
            if(type === 'market') {
                inner.innerHTML = `<h2>Market</h2><div class="market-grid">
                    <div class="market-item" onclick="STATE.bio+=500; closeModal()">Buy Energy (+500)</div>
                    <div class="market-item" onclick="STATE.plants.push(new Plant(Math.random()*800, STATE.horizon)); closeModal()">Instant Tree</div>
                </div>`;
            } else if(type === 'dna') {
                inner.innerHTML = `<h2>Splicer</h2><p>Click the Atom</p><div style="font-size:40px; margin:20px; cursor:pointer" onclick="STATE.bio+=10">‚öõÔ∏è</div>`;
            } else if(type === 'swarm') {
                inner.innerHTML = `<h2>Swarm</h2><p>Generating bio-energy...</p>`;
                STATE.swarmInt = setInterval(() => STATE.bio += 2, 1000);
            }
        }

        function closeModal() {
            document.getElementById('modal').style.display = 'none';
            clearInterval(STATE.swarmInt);
        }

        init();
    </script>
</body>
</html>
