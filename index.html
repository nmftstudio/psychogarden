<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>AETERNA | Psychoactive Frontier</title>
    <link href="https://fonts.googleapis.com/css2?family=Libre+Baskerville:ital,wght@0,400;0,700;1,400&family=Space+Mono&display=swap" rel="stylesheet">
    <style>
        :root {
            --gold: #d4af37;
            --void: #020402;
            --glass: rgba(10, 15, 10, 0.95);
            --border: rgba(212, 175, 55, 0.3);
        }

        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { 
            background: var(--void); 
            color: #e0eadd; 
            font-family: 'Libre Baskerville', serif; 
            overflow: hidden;
            transition: filter 1s ease; /* Para los efectos de la droga */
        }

        canvas { position: absolute; top: 0; left: 0; display: block; }
        #fxCanvas { pointer-events: none; z-index: 5; opacity: 0.6; }

        /* --- UI --- */
        #interface {
            position: absolute; z-index: 100; width: 100%; height: 100%;
            pointer-events: none; display: flex; flex-direction: column;
            justify-content: space-between; padding: 25px;
        }

        .hud-top { display: flex; justify-content: space-between; pointer-events: auto; }
        .data-box { 
            background: var(--glass); border: 1px solid var(--border);
            padding: 10px 20px; border-radius: 2px; backdrop-filter: blur(15px);
        }
        .data-box label { font-family: 'Space Mono', monospace; font-size: 9px; text-transform: uppercase; color: var(--gold); display: block; margin-bottom: 4px; }
        .data-box span { font-size: 18px; font-weight: 700; letter-spacing: 1px; }

        .nexus-nav { 
            position: absolute; left: 25px; top: 50%; transform: translateY(-50%);
            display: flex; flex-direction: column; gap: 12px; pointer-events: auto;
        }
        .nexus-btn {
            width: 48px; height: 48px; border: 1px solid var(--border);
            background: var(--glass); color: var(--gold); border-radius: 0; /* Square Pro Look */
            cursor: pointer; transition: 0.3s; font-size: 18px;
            display: flex; align-items: center; justify-content: center;
        }
        .nexus-btn:hover { background: var(--gold); color: var(--void); transform: scale(1.05); }

        .toolbar { 
            display: flex; justify-content: center; gap: 8px; pointer-events: auto;
            margin-bottom: 5px;
        }
        .tool {
            padding: 10px 24px; background: var(--glass); border: 1px solid var(--border);
            color: #fff; cursor: pointer; font-family: 'Space Mono', monospace;
            text-transform: uppercase; font-size: 10px; transition: 0.2s;
        }
        .tool.active { border-color: #fff; background: var(--gold); color: var(--void); }

        /* --- MODALES --- */
        .modal {
            position: fixed; inset: 0; background: rgba(0,0,0,0.95);
            display: none; align-items: center; justify-content: center; z-index: 1000;
            pointer-events: auto;
        }
        .modal-content {
            width: 95%; max-width: 450px; padding: 40px; border: 1px solid var(--gold);
            background: var(--void); text-align: center;
        }
        .market-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 12px; margin-top: 20px; }
        .market-item { border: 1px solid var(--border); padding: 15px; cursor: pointer; text-align: left; }
        .market-item:hover { border-color: #fff; background: #0a100a; }
        .market-item h4 { color: var(--gold); margin-bottom: 5px; font-size: 14px; }
        .market-item p { font-size: 10px; opacity: 0.7; }

    </style>
</head>
<body>

    <canvas id="skyCanvas"></canvas>
    <canvas id="mainCanvas"></canvas>
    <canvas id="fxCanvas"></canvas>

    <div id="interface">
        <div class="hud-top">
            <div class="data-box">
                <label>System Bio-Mass</label>
                <span id="stat-bio">1500</span>
            </div>
            <div class="data-box" style="text-align: right;">
                <label>Neuro-Clima</label>
                <span id="stat-weather">Lucid</span>
            </div>
        </div>

        <div class="nexus-nav">
            <button class="nexus-btn" onclick="openModule('market')">ðŸ›’</button>
            <button class="nexus-btn" onclick="openModule('dna')">ðŸ§¬</button>
            <button class="nexus-btn" onclick="openModule('vibe')">ðŸ§˜</button>
        </div>

        <div class="toolbar">
            <button class="tool active" id="tool-plant" onclick="setTool('plant')">Seed</button>
            <button class="tool" id="tool-inspect" onclick="setTool('inspect')">Inspect DNA</button>
        </div>
    </div>

    <div id="modal" class="modal">
        <div class="modal-content">
            <div id="modal-inner"></div>
            <button class="tool" style="margin-top:25px; width:100%" onclick="closeModal()">Return to Neural-Net</button>
        </div>
    </div>

    <script>
        /**
         * AETERNA: NEURO-EDITION
         * Procedural Psychoactive Ecosystem
         */

        const STATE = {
            bio: 1500, plants: [], entities: [],
            tool: 'plant', horizon: 0,
            globalTrip: 0, // 0 to 1, affects screen filters
            colors: { gold: '#d4af37', stimulation: '#4ade80', sedation: '#60a5fa', hallucination: '#a855f7' }
        };

        const canvasM = document.getElementById('mainCanvas');
        const ctxM = canvasM.getContext('2d');
        const canvasS = document.getElementById('skyCanvas');
        const ctxS = canvasS.getContext('2d');

        // --- PLANTAS PSICOACTIVAS ---
        class Plant {
            constructor(x, y, type = null) {
                this.x = x; this.y = y;
                this.growth = 0;
                this.age = 0;
                this.type = type || ['stim', 'sedative', 'trippy'][Math.floor(Math.random()*3)];
                this.hue = this.getHue();
                this.consumed = false;
            }
            getHue() {
                if(this.type === 'stim') return 120; // Verde
                if(this.type === 'sedative') return 210; // Azul
                return 280; // PÃºrpura
            }
            update() {
                if(!this.consumed && this.growth < 1) this.growth += 0.003;
                this.age += 0.02;
            }
            draw(ctx) {
                if(this.consumed) return;
                ctx.save();
                ctx.translate(this.x, this.y);
                // Glow effect based on psychoactivity
                ctx.shadowBlur = 15 * this.growth;
                ctx.shadowColor = `hsl(${this.hue}, 100%, 50%)`;
                this.renderBranch(ctx, 55 * this.growth, 0, 5);
                ctx.restore();
            }
            renderBranch(ctx, len, angle, depth) {
                if(depth <= 0) return;
                ctx.save();
                ctx.rotate(angle + Math.sin(this.age + len) * (this.type === 'stim' ? 0.08 : 0.02));
                ctx.strokeStyle = `hsl(${this.hue}, ${40 + (6-depth)*10}%, ${15 + (6-depth)*5}%)`;
                ctx.lineWidth = depth * 1.5;
                ctx.beginPath(); ctx.moveTo(0,0); ctx.lineTo(0, -len); ctx.stroke();
                ctx.translate(0, -len);
                const split = this.type === 'trippy' ? 0.8 : 0.4;
                this.renderBranch(ctx, len * 0.75, split, depth - 1);
                this.renderBranch(ctx, len * 0.75, -split, depth - 1);
                ctx.restore();
            }
        }

        // --- HUMANOS (OBSERVADORES AFECTADOS) ---
        class Observer {
            constructor() {
                this.x = -50; this.y = STATE.horizon;
                this.speed = 0.8;
                this.state = 'sober'; // sober, stim, high, zen
                this.tripTimer = 0;
                this.color = "white";
            }
            update() {
                // Inteligencia de consumo
                if(this.state === 'sober') {
                    STATE.plants.forEach(p => {
                        if(!p.consumed && p.growth > 0.8 && Math.abs(this.x - p.x) < 20) {
                            this.consume(p);
                        }
                    });
                }

                // Efectos de comportamiento
                if(this.state === 'stim') { this.x += this.speed * 2.5; this.color = STATE.colors.stimulation; }
                else if(this.state === 'zen') { this.x += this.speed * 0.2; this.color = STATE.colors.sedation; }
                else if(this.state === 'high') { this.x += Math.sin(Date.now()*0.01)*5 + this.speed; this.color = STATE.colors.hallucination; }
                else { this.x += this.speed; this.color = "white"; }

                if(this.tripTimer > 0) {
                    this.tripTimer--;
                    if(this.state === 'high') STATE.globalTrip = 0.5; 
                } else {
                    this.state = 'sober';
                    STATE.globalTrip *= 0.95;
                }

                return this.x < window.innerWidth + 100;
            }
            consume(plant) {
                plant.consumed = true;
                this.tripTimer = 400;
                if(plant.type === 'stim') this.state = 'stim';
                if(plant.type === 'sedative') this.state = 'zen';
                if(plant.type === 'trippy') this.state = 'high';
                console.log("Observador en estado:", this.state);
            }
            draw(ctx) {
                ctx.save();
                ctx.translate(this.x, this.y);
                ctx.shadowBlur = (this.state !== 'sober') ? 20 : 0;
                ctx.shadowColor = this.color;
                ctx.fillStyle = this.color;
                ctx.fillRect(-2, -30, 4, 20);
                ctx.beginPath(); ctx.arc(0, -35, 4, 0, Math.PI*2); ctx.fill();
                ctx.restore();
            }
        }

        // --- ENGINE CORE ---
        function init() {
            resize();
            window.onresize = resize;
            canvasM.onmousedown = handleInput;
            requestAnimationFrame(loop);
            
            // Ciclo de vida
            setInterval(() => {
                if(STATE.entities.length < 2) STATE.entities.push(new Observer());
            }, 10000);
        }

        function resize() {
            STATE.horizon = window.innerHeight * 0.55;
            [canvasM, canvasS].forEach(c => {
                c.width = window.innerWidth;
                c.height = window.innerHeight;
            });
        }

        function loop() {
            // Screen FX (Psicodelia)
            if(STATE.globalTrip > 0.1) {
                document.body.style.filter = `hue-rotate(${Date.now()*0.1 % 360}deg) saturate(2) contrast(1.2)`;
            } else {
                document.body.style.filter = `none`;
            }

            // Sky
            ctxS.fillStyle = '#020402';
            ctxS.fillRect(0,0, canvasS.width, canvasS.height);
            
            ctxM.clearRect(0,0, canvasM.width, canvasM.height);
            
            // Ground
            ctxM.fillStyle = '#050805';
            ctxM.fillRect(0, STATE.horizon, canvasM.width, canvasM.height);
            
            // Entities
            STATE.plants.forEach(p => { p.update(); p.draw(ctxM); });
            STATE.entities = STATE.entities.filter(e => {
                const active = e.update();
                e.draw(ctxM);
                return active;
            });

            document.getElementById('stat-bio').innerText = Math.floor(STATE.bio);
            document.getElementById('stat-weather').innerText = STATE.globalTrip > 0.1 ? 'ALTERED' : 'LUCID';

            requestAnimationFrame(loop);
        }

        function handleInput(e) {
            if(STATE.tool === 'plant' && e.clientY > STATE.horizon - 100) {
                if(STATE.bio >= 100) {
                    STATE.bio -= 100;
                    STATE.plants.push(new Plant(e.clientX, STATE.horizon));
                }
            }
        }

        function setTool(t) {
            STATE.tool = t;
            document.querySelectorAll('.tool').forEach(b => b.classList.remove('active'));
            document.getElementById(`tool-${t}`).classList.add('active');
        }

        // --- NEXUS MODULES ---
        function openModule(type) {
            const m = document.getElementById('modal');
            const inner = document.getElementById('modal-inner');
            m.style.display = 'flex';

            if(type === 'market') {
                inner.innerHTML = `
                    <h2 style="color:var(--gold)">Neural Market</h2>
                    <div class="market-grid">
                        <div class="market-item" onclick="spawnSpecial('stim')"><h4>Neuro-Moss</h4><p>Alcaloide Estimulante rÃ¡pido.</p></div>
                        <div class="market-item" onclick="spawnSpecial('sedative')"><h4>Void-Lilly</h4><p>Efecto Zen y cÃ¡mara lenta.</p></div>
                        <div class="market-item" onclick="spawnSpecial('trippy')"><h4>Glitch-Root</h4><p>DistorsiÃ³n de la realidad.</p></div>
                        <div class="market-item" onclick="STATE.bio += 1000; closeModal()"><h4>Bio-Inject</h4><p>+1000 Bio-Mass</p></div>
                    </div>
                `;
            } else if(type === 'dna') {
                inner.innerHTML = `<h2>Splicer Mini</h2><p>Click para sintetizar biomasa.</p>
                <div style="font-size:50px; margin:20px; cursor:pointer" onclick="STATE.bio+=20">ðŸ§ª</div>`;
            } else if(type === 'vibe') {
                inner.innerHTML = `<h2>Atmosphere</h2><p>Limpiando canales neuronales...</p>`;
                setTimeout(() => { STATE.globalTrip = 0; closeModal(); }, 2000);
            }
        }

        function spawnSpecial(type) {
            STATE.plants.push(new Plant(Math.random()*window.innerWidth, STATE.horizon, type));
            closeModal();
        }

        function closeModal() { document.getElementById('modal').style.display = 'none'; }

        init();
    </script>
</body>
</html>
