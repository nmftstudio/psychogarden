<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Overgrownd v3.0</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        
        body {
            font-family: system-ui, -apple-system, sans-serif;
            background: #000;
            color: #fff;
            overflow: hidden;
        }
        
        canvas {
            position: absolute;
            top: 0;
            left: 0;
        }
        
        #sky { z-index: 1; }
        #world { z-index: 2; }
        #particles { z-index: 3; pointer-events: none; }
        
        #ui {
            position: absolute;
            z-index: 10;
            width: 100%;
            height: 100%;
            pointer-events: none;
        }
        
        .panel {
            pointer-events: auto;
            background: rgba(0, 0, 0, 0.7);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 12px;
            padding: 15px 20px;
        }
        
        #topBar {
            position: absolute;
            top: 20px;
            left: 20px;
            right: 20px;
            display: flex;
            justify-content: space-between;
        }
        
        #stats {
            display: flex;
            gap: 20px;
        }
        
        .stat {
            display: flex;
            flex-direction: column;
        }
        
        .stat-label {
            font-size: 10px;
            opacity: 0.6;
            text-transform: uppercase;
        }
        
        .stat-value {
            font-size: 20px;
            font-weight: bold;
            color: #4ade80;
        }
        
        #weather {
            font-size: 24px;
        }
        
        #bottomBar {
            position: absolute;
            bottom: 20px;
            left: 20px;
            right: 20px;
            display: flex;
            justify-content: space-between;
            align-items: flex-end;
        }
        
        #controls {
            display: flex;
            gap: 10px;
        }
        
        button {
            background: rgba(74, 222, 128, 0.2);
            border: 1px solid rgba(74, 222, 128, 0.5);
            color: #4ade80;
            padding: 12px 20px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 14px;
            transition: all 0.3s;
            pointer-events: auto;
        }
        
        button:hover {
            background: rgba(74, 222, 128, 0.4);
            transform: translateY(-2px);
        }
        
        button:disabled {
            opacity: 0.3;
            cursor: not-allowed;
        }
        
        #log {
            position: absolute;
            top: 100px;
            right: 20px;
            max-width: 300px;
            pointer-events: none;
        }
        
        .log-entry {
            background: rgba(0, 0, 0, 0.8);
            border: 1px solid rgba(74, 222, 128, 0.3);
            padding: 10px;
            margin-bottom: 8px;
            border-radius: 6px;
            font-size: 12px;
            animation: fadeIn 0.3s;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateX(20px); }
            to { opacity: 1; transform: translateX(0); }
        }
    </style>
</head>
<body>
    <canvas id="sky"></canvas>
    <canvas id="world"></canvas>
    <canvas id="particles"></canvas>
    
    <div id="ui">
        <div id="topBar">
            <div class="panel" id="stats">
                <div class="stat">
                    <span class="stat-label">Biomasa</span>
                    <span class="stat-value" id="bioStat">0</span>
                </div>
                <div class="stat">
                    <span class="stat-label">Especies</span>
                    <span class="stat-value" id="speciesStat">0</span>
                </div>
                <div class="stat">
                    <span class="stat-label">Poblaci√≥n</span>
                    <span class="stat-value" id="popStat">0</span>
                </div>
            </div>
            
            <div class="panel">
                <div id="weather">‚òÄÔ∏è</div>
            </div>
        </div>
        
        <div id="log"></div>
        
        <div id="bottomBar">
            <div class="panel" id="controls">
                <button onclick="plantSeed()" id="plantBtn">üå± Plantar (30)</button>
                <button onclick="spawnCreature()">ü¶ã Criatura (50)</button>
                <button onclick="changeWeather()">üå¶Ô∏è Clima</button>
                <button onclick="clearWorld()">üóëÔ∏è Limpiar</button>
            </div>
        </div>
    </div>

    <script>
        // State
        const state = {
            bio: 500,
            plants: [],
            creatures: [],
            species: new Set(),
            weather: 'sunny',
            plantMode: false
        };

        // Weather types
        const weather = {
            sunny: { sky1: '#87CEEB', sky2: '#FFC896', icon: '‚òÄÔ∏è', wind: 0.3 },
            cloudy: { sky1: '#788CA0', sky2: '#A0AAB4', icon: '‚òÅÔ∏è', wind: 0.5 },
            rainy: { sky1: '#465064', sky2: '#646E78', icon: 'üåßÔ∏è', wind: 0.8 },
            night: { sky1: '#0A0A1E', sky2: '#1E1432', icon: 'üåô', wind: 0.2 }
        };

        let currentWeather = weather.sunny;
        let windSpeed = 0.3;

        // Canvas setup
        const skyCanvas = document.getElementById('sky');
        const worldCanvas = document.getElementById('world');
        const particlesCanvas = document.getElementById('particles');
        
        const skyCtx = skyCanvas.getContext('2d');
        const worldCtx = worldCanvas.getContext('2d');
        const particlesCtx = particlesCanvas.getContext('2d');

        function resizeCanvas() {
            const w = window.innerWidth;
            const h = window.innerHeight;
            
            [skyCanvas, worldCanvas, particlesCanvas].forEach(canvas => {
                canvas.width = w;
                canvas.height = h;
            });
        }

        resizeCanvas();
        window.addEventListener('resize', resizeCanvas);

        // Plant class
        class Plant {
            constructor(x, y) {
                this.x = x;
                this.y = y;
                this.age = 0;
                this.growth = 0;
                this.dead = false;
                
                // DNA
                this.size = 40 + Math.random() * 60;
                this.branches = 3 + Math.floor(Math.random() * 4);
                this.hue = Math.random() * 360;
                this.angle = 0.3 + Math.random() * 0.4;
                this.hasFlowers = Math.random() > 0.5;
                this.windOffset = Math.random() * Math.PI * 2;
                
                const type = ['√Årbol', 'Arbusto', 'Helecho'][Math.floor(Math.random() * 3)];
                state.species.add(type);
            }
            
            update() {
                if (this.growth < 1) {
                    this.growth += 0.005;
                }
                this.age++;
                
                if (this.age > 3000) {
                    this.dead = true;
                    state.bio += 10;
                }
            }
            
            draw(ctx) {
                if (this.dead) return;
                
                ctx.save();
                ctx.translate(this.x, this.y);
                ctx.scale(this.growth, this.growth);
                
                const sway = Math.sin(Date.now() * 0.001 + this.windOffset) * windSpeed * 0.05;
                ctx.rotate(sway);
                
                this.drawBranch(ctx, this.size, 0, this.branches);
                
                ctx.restore();
            }
            
            drawBranch(ctx, len, angle, depth) {
                if (depth <= 0 || len < 2) return;
                
                ctx.save();
                ctx.rotate(angle);
                
                ctx.strokeStyle = `hsl(${this.hue}, 60%, ${40 + depth * 5}%)`;
                ctx.lineWidth = Math.max(1, depth * 1.5);
                ctx.lineCap = 'round';
                
                ctx.beginPath();
                ctx.moveTo(0, 0);
                ctx.lineTo(0, -len);
                ctx.stroke();
                
                // Leaves
                if (depth <= 2 && Math.random() < 0.3) {
                    ctx.fillStyle = `hsl(${this.hue}, 70%, 50%)`;
                    ctx.beginPath();
                    ctx.arc(0, -len, 3, 0, Math.PI * 2);
                    ctx.fill();
                }
                
                // Flowers
                if (depth === 1 && this.hasFlowers && Math.random() < 0.5) {
                    ctx.fillStyle = `hsl(${(this.hue + 180) % 360}, 80%, 60%)`;
                    ctx.beginPath();
                    ctx.arc(0, -len, 4, 0, Math.PI * 2);
                    ctx.fill();
                }
                
                ctx.translate(0, -len);
                
                for (let i = 0; i < 2; i++) {
                    const newAngle = (Math.random() - 0.5) * this.angle * 2;
                    this.drawBranch(ctx, len * 0.7, newAngle, depth - 1);
                }
                
                ctx.restore();
            }
        }

        // Creature class
        class Creature {
            constructor(x, y) {
                this.x = x;
                this.y = y;
                this.vx = (Math.random() - 0.5) * 3;
                this.vy = (Math.random() - 0.5) * 3;
                this.age = 0;
                this.dead = false;
                
                this.size = 8 + Math.random() * 8;
                this.hue = Math.random() * 360;
                this.segments = 3 + Math.floor(Math.random() * 3);
                this.type = ['Volador', 'Saltador'][Math.floor(Math.random() * 2)];
                
                state.species.add(this.type);
            }
            
            update() {
                this.age++;
                
                // Movement
                this.x += this.vx;
                this.y += this.vy;
                
                // Boundaries
                if (this.x < 0) this.x = window.innerWidth;
                if (this.x > window.innerWidth) this.x = 0;
                if (this.y < 50) this.vy = Math.abs(this.vy);
                if (this.y > window.innerHeight - 100) this.vy = -Math.abs(this.vy);
                
                // Random direction change
                if (Math.random() < 0.02) {
                    this.vx += (Math.random() - 0.5) * 0.5;
                    this.vy += (Math.random() - 0.5) * 0.5;
                }
                
                if (this.age > 1500) {
                    this.dead = true;
                }
            }
            
            draw(ctx) {
                if (this.dead) return;
                
                ctx.save();
                ctx.translate(this.x, this.y);
                
                for (let i = 0; i < this.segments; i++) {
                    const offset = Math.sin(Date.now() * 0.005 + i * 0.5) * 2;
                    const size = this.size * (1 - i * 0.15);
                    
                    ctx.fillStyle = `hsl(${this.hue}, 70%, ${50 - i * 5}%)`;
                    ctx.beginPath();
                    ctx.arc(offset, -i * this.size * 0.6, size, 0, Math.PI * 2);
                    ctx.fill();
                }
                
                // Wings
                const wingFlap = Math.sin(Date.now() * 0.01) * 0.3;
                ctx.strokeStyle = `hsla(${this.hue}, 50%, 60%, 0.6)`;
                ctx.lineWidth = 2;
                
                ctx.beginPath();
                ctx.moveTo(0, -this.size * 0.3);
                ctx.quadraticCurveTo(-this.size * 1.5, -this.size * (0.8 + wingFlap), -this.size * 1.2, -this.size * 0.2);
                ctx.stroke();
                
                ctx.beginPath();
                ctx.moveTo(0, -this.size * 0.3);
                ctx.quadraticCurveTo(this.size * 1.5, -this.size * (0.8 + wingFlap), this.size * 1.2, -this.size * 0.2);
                ctx.stroke();
                
                ctx.restore();
            }
        }

        // Initialize world
        function initWorld() {
            for (let i = 0; i < 8; i++) {
                const x = (i + 1) * (window.innerWidth / 9);
                state.plants.push(new Plant(x, window.innerHeight - 80));
            }
            
            for (let i = 0; i < 5; i++) {
                const x = Math.random() * window.innerWidth;
                const y = window.innerHeight - 150 - Math.random() * 200;
                state.creatures.push(new Creature(x, y));
            }
        }

        // Draw functions
        function drawSky() {
            const gradient = skyCtx.createLinearGradient(0, 0, 0, window.innerHeight);
            gradient.addColorStop(0, currentWeather.sky1);
            gradient.addColorStop(1, currentWeather.sky2);
            
            skyCtx.fillStyle = gradient;
            skyCtx.fillRect(0, 0, window.innerWidth, window.innerHeight);
            
            // Horizon
            const horizonY = window.innerHeight * 0.65;
            skyCtx.fillStyle = 'rgba(0, 0, 0, 0.2)';
            skyCtx.fillRect(0, horizonY, window.innerWidth, window.innerHeight - horizonY);
        }

        function drawGround() {
            const groundY = window.innerHeight - 80;
            
            worldCtx.fillStyle = '#1a1a1a';
            worldCtx.fillRect(0, groundY, window.innerWidth, 80);
            
            // Grass
            worldCtx.strokeStyle = 'rgba(74, 222, 128, 0.3)';
            worldCtx.lineWidth = 1;
            
            for (let x = 0; x < window.innerWidth; x += 5) {
                const height = 5 + Math.random() * 8;
                const sway = Math.sin(Date.now() * 0.002 + x * 0.1) * windSpeed * 2;
                
                worldCtx.beginPath();
                worldCtx.moveTo(x, groundY);
                worldCtx.lineTo(x + sway, groundY - height);
                worldCtx.stroke();
            }
        }

        function drawRain() {
            if (state.weather !== 'rainy') return;
            
            particlesCtx.strokeStyle = 'rgba(200, 220, 255, 0.5)';
            particlesCtx.lineWidth = 2;
            
            for (let i = 0; i < 100; i++) {
                const x = (Date.now() * 0.1 + i * 50) % window.innerWidth;
                const y = (Date.now() * 0.5 + i * 20) % window.innerHeight;
                
                particlesCtx.beginPath();
                particlesCtx.moveTo(x, y);
                particlesCtx.lineTo(x + 2, y + 15);
                particlesCtx.stroke();
            }
        }

        // Game loop
        function gameLoop() {
            // Sky
            drawSky();
            
            // World
            worldCtx.clearRect(0, 0, window.innerWidth, window.innerHeight);
            drawGround();
            
            // Update & draw plants
            state.plants = state.plants.filter(plant => {
                plant.update();
                plant.draw(worldCtx);
                return !plant.dead;
            });
            
            // Update & draw creatures
            state.creatures = state.creatures.filter(creature => {
                creature.update();
                creature.draw(worldCtx);
                return !creature.dead;
            });
            
            // Particles
            particlesCtx.clearRect(0, 0, window.innerWidth, window.innerHeight);
            drawRain();
            
            // Auto spawn
            if (Math.random() < 0.001 && state.plants.length < 20) {
                state.plants.push(new Plant(Math.random() * window.innerWidth, window.innerHeight - 80));
            }
            
            if (Math.random() < 0.0005 && state.creatures.length < 15) {
                state.creatures.push(new Creature(
                    Math.random() * window.innerWidth,
                    window.innerHeight - 150 - Math.random() * 200
                ));
            }
            
            // Passive bio
            state.bio += 0.05;
            
            // Update UI
            updateUI();
            
            requestAnimationFrame(gameLoop);
        }

        // UI functions
        function updateUI() {
            document.getElementById('bioStat').textContent = Math.floor(state.bio);
            document.getElementById('speciesStat').textContent = state.species.size;
            document.getElementById('popStat').textContent = state.plants.length + state.creatures.length;
            document.getElementById('weather').textContent = currentWeather.icon;
            
            const plantBtn = document.getElementById('plantBtn');
            plantBtn.disabled = state.bio < 30;
        }

        function addLog(msg) {
            const log = document.getElementById('log');
            const entry = document.createElement('div');
            entry.className = 'log-entry';
            entry.textContent = msg;
            log.appendChild(entry);
            
            if (log.children.length > 5) {
                log.removeChild(log.firstChild);
            }
            
            setTimeout(() => {
                if (entry.parentNode) {
                    entry.style.opacity = '0';
                    setTimeout(() => entry.remove(), 500);
                }
            }, 5000);
        }

        // Actions
        function plantSeed() {
            if (state.bio >= 30) {
                state.plantMode = true;
                worldCanvas.style.cursor = 'cell';
                addLog('üå± Click en el suelo para plantar');
            }
        }

        function spawnCreature() {
            if (state.bio >= 50) {
                state.creatures.push(new Creature(
                    Math.random() * window.innerWidth,
                    window.innerHeight - 150 - Math.random() * 200
                ));
                state.bio -= 50;
                addLog('ü¶ã Criatura generada');
            } else {
                addLog('‚ùå Biomasa insuficiente');
            }
        }

        function changeWeather() {
            const types = ['sunny', 'cloudy', 'rainy', 'night'];
            const current = types.indexOf(state.weather);
            const next = types[(current + 1) % types.length];
            
            state.weather = next;
            currentWeather = weather[next];
            windSpeed = currentWeather.wind;
            
            addLog(`üå¶Ô∏è Clima: ${currentWeather.icon}`);
        }

        function clearWorld() {
            state.plants = [];
            state.creatures = [];
            addLog('üóëÔ∏è Mundo limpiado');
        }

        // Click handler
        worldCanvas.addEventListener('click', (e) => {
            if (state.plantMode) {
                const rect = worldCanvas.getBoundingClientRect();
                const x = e.clientX - rect.left;
                const y = e.clientY - rect.top;
                
                if (y > window.innerHeight - 200 && state.bio >= 30) {
                    state.plants.push(new Plant(x, window.innerHeight - 80));
                    state.bio -= 30;
                    addLog('üå± Planta sembrada');
                    state.plantMode = false;
                    worldCanvas.style.cursor = 'default';
                }
            }
        });

        // Start
        initWorld();
        gameLoop();
        addLog('üåø Overgrownd v3.0 iniciado');
    </script>
</body>
</html>
